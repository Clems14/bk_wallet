<template>
	<div v-if="logged">
		<br><br>
		<b-container>
			<b-row>
				<b-col>
					<div style="height:560px; background-color: #FFFFFF; overflow:hidden; box-sizing: border-box; border: 1px solid #56667F; border-radius: 4px; text-align: right; line-height:14px; font-size: 12px; box-sizing:content-box; font-feature-settings: normal; text-size-adjust: 100%; box-shadow: inset 0 -20px 0 0 #56667F;padding:1px;padding: 0px; margin: 0px;">
						<div style="height:540px;padding:0px;margin:0px;">
							<iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=859&pref_coin_id=1505" width="100%" height="536" scrolling="auto" marginwidth="0" marginheight="0" frameborder="0" border="0" style="border:0;margin:0;padding:0;line-height:14px;box-sizing:content-box;"></iframe>
						</div>
						<div style="color: #FFFFFF; line-height: 14px; font-weight: 400; font-size: 11px; box-sizing:content-box; margin: 3px 6px 10px 0px; font-family: Verdana, Tahoma, Arial, sans-serif;">powered by&nbsp;<a href="https://coinlib.io" target="_blank" style="font-weight: 500; color: #FFFFFF; font-size: 11px; text-decoration:none;">Coinlib</a>
						</div>
					</div>
				</b-col>
				<b-col>
					<div style="height:560px; background-color: #FFFFFF; overflow:hidden; box-sizing: border-box; border: 1px solid #56667F; border-radius: 4px; text-align: right; line-height:14px; font-size: 12px; box-sizing:content-box; font-feature-settings: normal; text-size-adjust: 100%; box-shadow: inset 0 -20px 0 0 #56667F;padding:1px;padding: 0px; margin: 0px;">
						<div style="height:540px;padding:0px;margin:0px;">
							<iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=145&pref_coin_id=1505" width="100%" height="536" scrolling="auto" marginwidth="0" marginheight="0" frameborder="0" border="0" style="border:0;margin:0;padding:0;line-height:14px;box-sizing:content-box;"></iframe>
						</div>
						<div style="color: #FFFFFF; line-height: 14px; font-weight: 400; font-size: 11px; box-sizing:content-box; margin: 3px 6px 10px 0px; font-family: Verdana, Tahoma, Arial, sans-serif;">powered by&nbsp;<a href="https://coinlib.io" target="_blank" style="font-weight: 500; color: #FFFFFF; font-size: 11px; text-decoration:none;">Coinlib</a>
						</div>
					</div>
				</b-col>
				<b-col>
					<div style="height:560px;  background-color: #FFFFFF; overflow:hidden; box-sizing: border-box; border: 1px solid #56667F; border-radius: 4px; text-align: right; line-height:14px; font-size: 12px; box-sizing:content-box; font-feature-settings: normal; text-size-adjust: 100%; box-shadow: inset 0 -20px 0 0 #56667F;padding:1px;padding: 0px; margin: 0px;"><div style="height:540px;padding:0px;margin:0px;"><iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=157&pref_coin_id=1505" width="100%" height="536" scrolling="auto" marginwidth="0" marginheight="0" frameborder="0" border="0" style="border:0;margin:0;padding:0;line-height:14px;box-sizing:content-box;"></iframe></div><div style="color: #FFFFFF; line-height: 14px; font-weight: 400; font-size: 11px; box-sizing:content-box; margin: 3px 6px 10px 0px; font-family: Verdana, Tahoma, Arial, sans-serif;">powered by&nbsp;<a href="https://coinlib.io" target="_blank" style="font-weight: 500; color: #FFFFFF; font-size: 11px; text-decoration:none;">Coinlib</a></div></div>
				</b-col>
			</b-row>
			<br>
			<b-row>
				<b-col>
					<div style="height:560px; background-color: #FFFFFF; overflow:hidden; box-sizing: border-box; border: 1px solid #56667F; border-radius: 4px; text-align: right; line-height:14px; font-size: 12px; box-sizing:content-box; font-feature-settings: normal; text-size-adjust: 100%; box-shadow: inset 0 -20px 0 0 #56667F;padding:1px;padding: 0px; margin: 0px;"><div style="height:540px;padding:0px;margin:0px;"><iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=585&pref_coin_id=1505" width="100%" height="536" scrolling="auto" marginwidth="0" marginheight="0" frameborder="0" border="0" style="border:0;margin:0;padding:0;line-height:14px;box-sizing:content-box;"></iframe></div><div style="color: #FFFFFF; line-height: 14px; font-weight: 400; font-size: 11px; box-sizing:content-box; margin: 3px 6px 10px 0px; font-family: Verdana, Tahoma, Arial, sans-serif;">powered by&nbsp;<a href="https://coinlib.io" target="_blank" style="font-weight: 500; color: #FFFFFF; font-size: 11px; text-decoration:none;">Coinlib</a></div></div>
				</b-col>
				<b-col>
					<div style="height:560px; background-color: #FFFFFF; overflow:hidden; box-sizing: border-box; border: 1px solid #56667F; border-radius: 4px; text-align: right; line-height:14px; font-size: 12px; box-sizing:content-box; font-feature-settings: normal; text-size-adjust: 100%; box-shadow: inset 0 -20px 0 0 #56667F;padding:1px;padding: 0px; margin: 0px;"><div style="height:540px;padding:0px;margin:0px;"><iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=619&pref_coin_id=1505" width="100%" height="536" scrolling="auto" marginwidth="0" marginheight="0" frameborder="0" border="0" style="border:0;margin:0;padding:0;line-height:14px;box-sizing:content-box;"></iframe></div><div style="color: #FFFFFF; line-height: 14px; font-weight: 400; font-size: 11px; box-sizing:content-box; margin: 3px 6px 10px 0px; font-family: Verdana, Tahoma, Arial, sans-serif;">powered by&nbsp;<a href="https://coinlib.io" target="_blank" style="font-weight: 500; color: #FFFFFF; font-size: 11px; text-decoration:none;">Coinlib</a></div></div>
				</b-col>
				<b-col>
					<div style="height:560px; background-color: #FFFFFF; overflow:hidden; box-sizing: border-box; border: 1px solid #56667F; border-radius: 4px; text-align: right; line-height:14px; font-size: 12px; box-sizing:content-box; font-feature-settings: normal; text-size-adjust: 100%; box-shadow: inset 0 -20px 0 0 #56667F;padding:1px;padding: 0px; margin: 0px;"><div style="height:540px;padding:0px;margin:0px;"><iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=359&pref_coin_id=1505" width="100%" height="536" scrolling="auto" marginwidth="0" marginheight="0" frameborder="0" border="0" style="border:0;margin:0;padding:0;line-height:14px;box-sizing:content-box;"></iframe></div><div style="color: #FFFFFF; line-height: 14px; font-weight: 400; font-size: 11px; box-sizing:content-box; margin: 3px 6px 10px 0px; font-family: Verdana, Tahoma, Arial, sans-serif;">powered by&nbsp;<a href="https://coinlib.io" target="_blank" style="font-weight: 500; color: #FFFFFF; font-size: 11px; text-decoration:none;">Coinlib</a></div></div>
				</b-col>
			</b-row>
		</b-container>
		<br><br>
		<div class="tableau">
			<b-table hover responsive :items="items" caption-top>
				<template slot="table-caption"><h4 id="account">Your account</h4></template>
				<template slot="SEND" slot-scope="row">
					<b-button size="sm" variant="primary" pill v-b-modal.modal-prevent-closing>
			          	SEND
			        </b-button>
				</template>
				<template slot="TOKEN" slot-scope="row">
					<b-button size="sm" variant="primary" pill v-b-modal.bv-modal-example>
			          	Copy
			        </b-button>
			        <!-- <b-button v-clipboard:copy=""></button> -->
				</template>
				<template slot="QrCode" slot-scope="row">
					<b-button size="sm" variant="primary" pill @click="$bvModal.show('bv-modal-qrcode')">
			          	Show
			        </b-button>
				</template>
			</b-table>
			<b-modal id="bv-modal-example" hide-footer>
				<template v-if="!testCopy">
				    <div class="d-block text-center">
				    	<input type="text" :value="getQrCode3" id="copy">
				    </div>
				</template>

				<!-- <template v-if="testCopy1">
				    <div class="d-block text-center">
				    	<input type="text" :value="getQrCode1" id="copy">
				    </div>
				</template>
				<template v-else-if="testCopy2">
				    <div class="d-block text-center">
				    	<input type="text" :value="getQrCode2" id="copy">
				    </div>
				</template>
				<template v-else-if="testCopy3">
				    <div class="d-block text-center">
				    	<input type="text" :value="getQrCode3" id="copy">
				    </div>
				</template>
				<template v-else-if="testCopy4">
				    <div class="d-block text-center">
				    	<input type="text" :value="getQrCode4" id="copy">
				    </div>
				</template>
				<template v-else-if="testCopy5">
				    <div class="d-block text-center">
				    	<input type="text" :value="getQrCode5" id="copy">
				    	<p>iejrjbvibr</p>
				    </div>
				</template> -->
				
			    <b-button class="mt-3" block @click="$bvModal.hide('bv-modal-example')" v-on:click="clipboard">Copy</b-button>
			</b-modal>
			<b-modal id="bv-modal-qrcode" hide-footer>
			    
			    <b-button class="mt-3" block @click="$bvModal.hide('bv-modal-qrcode')">Close</b-button>
			</b-modal>
			<b-modal id="modal-prevent-closing" ref="modal" title="Send" @show="resetModal" @hidden="resetModal" @ok="handleOk" >
				<form ref="form" @submit.stop.prevent="handleSubmit" >
					<b-form-group :state="nameState" label="To" label-for="name-input" invalid-feedback="To is required" required>
						<b-form-input id="to-input" v-model="transfer.to" :state="nameState" required type="email"></b-form-input>
					</b-form-group>
					<b-form-group :state="nameState" label="Token" label-for="name-input" invalid-feedback="Token is required" required>
						<!-- <b-form-input id="token-input" v-model="transfer.tok" :state="nameState" required></b-form-input> -->
						<b-form-select id="token-input" v-model="transfer.tok" required :options="options" :state="nameState">
				        </b-form-select>
					</b-form-group>
					<b-form-group :state="nameState" label="Value" label-for="name-input" invalid-feedback="Value is required" required>
						<b-form-input id="value-input" v-model="transfer.value" :state="nameState" required type="number"></b-form-input>
					</b-form-group>
				</form>
			</b-modal>
			<br>
			<b-container>
				<b-row class="top">
					<b-col>
						<qrcode :value="getQrCode" :options="{ size: 100 }"></qrcode>
						<figcaption>BTC</figcaption>
					</b-col>
					<b-col>
						<qrcode :value="getQrCode1" :options="{ size: 100 }"></qrcode>
						<figcaption>BCH</figcaption>
					</b-col>
				</b-row>
				<b-row>
					<b-col>
						<qrcode :value="getQrCode2" :options="{ size: 100 }" alt="test"></qrcode>
						<figcaption>EOS</figcaption>
					</b-col>
					<b-col>
						<qrcode :value="getQrCode3" :options="{ size: 100 }"></qrcode>
						<figcaption>ETH</figcaption>
					</b-col>
				</b-row>
				<b-row>
					<b-col>
						<qrcode :value="getQrCode4" :options="{ size: 100 }"></qrcode>
						<figcaption>LTC</figcaption>
					</b-col>
					<b-col>
						<qrcode :value="getQrCode5" :options="{ size: 100 }"></qrcode>
						<figcaption>XRP</figcaption>
					</b-col>
				</b-row>
			</b-container>
				
		</div>

		<br><br><br>

		<div class="tableau">
			<b-container>
				<b-row>
					<b-col>
						<b-table hover responsive :items="haveHistory" caption-top :current-page="currentPage" :per-page="perPage">
							<template slot="table-caption"><h4 id="history">History Transaction</h4>
								<b-form class="formulaire1" v-on:submit.prevent="historyTransaction">
									<b-form-select id="input-2" v-model="choiceTokenHistory" required :options="options" class="form-control">
								        </b-form-select>

								    <div class="decal">
					      				<b-button type="submit" variant="primary">History transaction</b-button>
					      			</div>
					      		</b-form>
							</template>
							<!-- <template !important>
								<thead role="rowgroup" class>
									<tr role="row">
										<th role="columnheader" scope="col" aria-colindex="1" class>Id</th>
										<th role="columnheader" scope="col" aria-colindex="2" class>Id</th>
										<th role="columnheader" scope="col" aria-colindex="3" class>Id</th>
										<th role="columnheader" scope="col" aria-colindex="4" class>Id</th>
										<th role="columnheader" scope="col" aria-colindex="5" class>Id</th>
										<th role="columnheader" scope="col" aria-colindex="6" class>Id</th>
									</tr>
								</thead>
							</template> -->
						</b-table>
					</b-col>
				</b-row>
				<b-row>
					<b-col>
						<b-pagination v-model="currentPage" :total-rows="totalRows" :per-page="perPage" align="center"></b-pagination>
					</b-col>
				</b-row>
			</b-container>
		</div>

			
		<br><br><br>

		<b-container>
			<b-form class="formulaire" v-on:submit.prevent="withdraw">
				<h4 id="withdraw">Withdraw</h4>
				<br>
				<b-row>
	      			<b-col>
				        <b-form-select id="input-2" v-model="form.selected" required :options="options" class="form-control">
				        </b-form-select>
				    </b-col>
		    	</b-row>
				<br>
	      		<b-row>
	      			<b-col>
				        <b-form-input id="input-3" type="text" v-model="form.to" required placeholder="To" class="form-control">
				        </b-form-input>
				    </b-col>
			    </b-row>
			    <br>
	      		<b-row>
	      			<b-col>
				        <b-form-input id="input-4" type="number" v-model="form.value" required placeholder="Value" step="0.0001" class="form-control"></b-form-input>
				    </b-col>
			    </b-row>
			    <br>
	      		<b-row>
	      			<b-col>
				        <b-form-input id="input-5" type="text" v-model="form.message" required placeholder="Message"class="form-control"></b-form-input>
				    </b-col>
			    </b-row>
			    <div class="decal">
	      			<b-button type="submit" variant="primary">WithDraw</b-button>
	      		</div>
	    	</b-form>
	    </b-container>

	    <br><br>
	</div>
</template>
<!-- 
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script> -->
<script>
	export default{
		name: 'mainpage',

		data() {
			return {
				items: [
					{NAME : 'btc' , BALANCE : this.$store.getters.getbtcBalance, SEND: null, TOKEN: null, QrCode: null},
					{NAME : 'bch' , BALANCE : this.$store.getters.getbchBalance, SEND: null, TOKEN: null, QrCode: null},
					{NAME : 'eos' , BALANCE : this.$store.getters.geteosBalance, SEND: null, TOKEN: null, QrCode: null},
					{NAME : 'eth' , BALANCE : this.$store.getters.getethBalance, SEND: null, TOKEN: this.$store.getters.getEth, QrCode: null},
					{NAME : 'ltc' , BALANCE : this.$store.getters.getltcBalance, SEND: null, TOKEN: null, QrCode: null},
					{NAME : 'xrp' , BALANCE : this.$store.getters.getxrpBalance, SEND: null, TOKEN: null, QrCode: null},
				],

				totalRows: 1,
        		currentPage: 1,
        		perPage: 10,

				haveHistory : [],

				fields: {
					_id:{
						label:"Id",
						sortable: true
					},

					txHash:{
						label:"TxHash",
						sortable: true
					},

					tokenName:{
						label:"Token",
						sortable: true
					},

					amount:{
						label:"Amount",
						sortable: true
					},

					status:{
						label:"Status",
						sortable: true
					},

					message:{
						label:"Message",
						sortable: true
					},
				},

				form: {
					email: null,
					selected: null,
					to: null,
					value: null,
					message: null,
				},

				transfer: {
					to: null,
					tok: null,
					value: null,
				},

				choiceTokenHistory: null,
				
		        nameState: null,


				options: [
					{value : null, text: 'Please select a token name'},
					{value : 'btc', text: 'BTC'},
					{value : 'bch', text: 'BCH'},
					{value : 'eos', text: 'EOS'},
					{value : 'eth', text: 'ETH'},
					{value : 'ltc', text: 'LTC'},
					{value : 'xrp', text: 'XRP'},
				],
			}
		},

		methods: {

			clipboard(){
				if(this.items[0].NAME == 'btc'){
					console.log(click().NAME);
					let copytext = document.getElementById("copy");
					console.log(copytext);
					copytext.select();
					document.execCommand('copy');
				}

				// console.log(this.$store.getters.getBtc);
				
				// console.log(this.items);
			},

			testCopy(){
				if(this.items[0].NAME == 'btc'){
					return true;
				}
			},

			testCopy1(){
				if(this.items[1].NAME == 'bch'){
					return true;
				}
			},

			testCopy2(){
				if(this.items[2].NAME == 'eos'){
					return true;
				}
			},

			testCopy3(){
				console.log("ca me fait chier");
				if(this.items[3].NAME == click().items[3].NAME){
					return true;
				}
			},

			testCopy4(){
				if(this.items[4].NAME == 'ltc'){
					return true;
				}
			},

			testCopy5(){
				if(this.items[5].NAME == 'xrp'){
					return true;
				}
			},

			withdraw(){
				this.$store.dispatch('doWithdraw', {
					email: this.$store.getters.getEmail,
					option: this.form.selected,
					to: this.form.to,
					value: Number(this.form.value),
					message: this.form.message,					
				})

				console.log(this.$store.getters.getEmail);
				console.log(this.form.selected);
				console.log(this.form.to);
				console.log(Number(this.form.value));
				console.log(this.form.message);
			},

			historyTransaction() {
				this.$store.dispatch('getHistory', {
					type: this.choiceTokenHistory
				})
					.then(response =>{
						let taille;
						this.taille = response.length;
						console.log(this.taille);
						if(this.taille == 0){
							console.log("test");
							alert("No transaction for this cryptocurrencies");
							window.location.href='/'
						}
						// console.log(this.test[0]._id);
						for(var i=0; i<this.taille; i++ ){
							// this.test.push([ {id: response[i]._id, TxHash: response[i].txHash, Token: response[i].tokenName, Amount: response[i].amount, Status: response[i].status, Message: response[i].message}]);
							this.haveHistory.push([response[i]._id, response[i].txHash, response[i].tokenName, response[i].amount, response[i].status, response[i].message])
							// this.test.push([ {response[i]._id} ])
						}
					})
				;
			},

			checkFormValidity() {
		    	const valid = this.$refs.form
		        this.nameState = valid ? 'valid' : 'invalid'
		        return valid
		    },
		    resetModal() {
		    	this.transfer.to = null
		    	this.transfer.tok = null
		    	this.transfer.value = null
		        this.nameState = null
		    },
		    handleOk(bvModalEvt) {
		        // Prevent modal from closing
		        bvModalEvt.preventDefault()
		        // Trigger submit handler
		        this.handleSubmit()
		    },
		    handleSubmit() {
		        // Exit when the form isn't valid
		        if (!this.checkFormValidity()) {
		        	return
		        }
		        // Push the name to submitted names
		     //    this.submittedNames.push(this.transfer.to)
		    	// this.submittedNames.push(this.transfer.tok)
		    	// this.submittedNames.push(this.transfer.value)
		     //    console.log(this.submittedNames);
		     	this.$store.dispatch('doTransfer', {
		     		to: this.transfer.to,
		     		select: this.transfer.tok,
		     		value: Number(this.transfer.value),
		     	})
		    	/*console.log(this.transfer.to)
		    	console.log(this.transfer.tok)
		    	console.log(Number(this.transfer.value))*/
		        // Hide the modal manually
		        this.$nextTick(() => {
		        	this.$refs.modal.hide()
		        })
		    }
		},

		computed: {

			logged(){

				// console.log(this.$store.getters.getEmail);
				// console.log(this.$store.getters.loggedIn);
				return this.$store.getters.loggedIn;
			},

			getQrCode(){
				return this.$store.getters.getBch;
			},

			getQrCode1(){
				return this.$store.getters.getBtc;
			},

			getQrCode2(){
				return this.$store.getters.getEos;
			},

			getQrCode3(){
				return this.$store.getters.getEth;
			},

			getQrCode4(){
				return this.$store.getters.getLtc;
			},

			getQrCode5(){
				return this.$store.getters.getXrp;
			},

			getTransaction(){
				return this.$store.getters.getTable;
			}
		},

		mounted() {

			this.$store.dispatch('getBalance');
		},
	};
</script>



<style>
	.tableau{
		width: 85%;
		background-color: white;
		padding: 10px;
		border-radius: 15px;
		margin: auto;
		display: flex;
	}

	.table{
		margin-bottom: 0 !important; 
	}

	h4{
		text-align: center;
		color: #181E3D !important;
	}

	.top{
		margin-top: 50px;
	}

	canvas{
		padding: 10px;
	}

	figcaption{
		padding-left: 15px;
	}

	.btn-primary{
		background-color: #0667D0 !important;
		border-color: #0667D0 !important;
	}

	.formulaire1{
		margin-left: auto;
		margin-right: auto;
		background-color: white;
		padding: 20px;
		width: 30%;
		border-radius: 15px;
	}

</style>